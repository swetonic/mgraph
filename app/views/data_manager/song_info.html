
<script src="/javascripts/jquery-1.7.2.js?1340154579" type="text/javascript"></script>
<script src="/javascripts/underscore.js?1340301754" type="text/javascript"></script>
<script src="/javascripts/backbone.js?1340153954" type="text/javascript"></script>


<script type="text/template" id="item-template">
    <div class="view">
      <label></label>
    </div>
</script>
  
<script type="text/javascript">

    $(document).ready(function() {
        
        var SongInfo = Backbone.Model.extend({
            title: "",
            initialize: function() {
                  if (!this.get("title")) {
                    this.set({"title": this.defaults.title});
                  }
                  if (!this.get("label")) {
                    this.set({"label": this.defaults.label});
                  }
            },
            
            defaults: function() {
              return {
                title: "",
                label: "",
                ids: {},
                rating: 0
              };
            }
        });

        var SongCollection = Backbone.Collection.extend({
            model: SongInfo,
            
            done: function() {
                //return this.filter(function(todo){ return todo.get('done'); });
            },
            
            comparator: function(song) {
                return song.attributes.rating;
            }
        });
        
        var SongView = Backbone.View.extend({
            
            tagName: "li",
            className: "song-row",
            template: function() {
                var temp = _.template($('#item-template').html());
                return temp
            },
            events: {},
            render: function() {
                console.log(this.model.toJSON());
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            }
        
        });

        var collection = new SongCollection;

        var AppView = Backbone.View.extend({        
            el: $('#container'),
            
            initialize: function() {
                this.footer = this.$('footer');
                this.main = $('#main');
                collection.bind('add', this.addOne, this);
                collection.bind('reset', this.addAll, this);
                collection.bind('all', this.render, this);
                collection.fetch({url:"/data_manager/song_info_json?song=autumn leaves"});
            },
            
            render: function() {
                if(collection.length) {
                    this.main.show();
                    this.footer.show();
                }
            },
            
            addOne: function(song) {
                var view = new SongView({model: song});
                var r = view.render().el;
                this.$('#songlist').append(view.render().el);
            },
            
            addAll: function() {
                collection.each(this.addOne);
            },
            
        });

        var App = new AppView;

        
        /*$.ajax(url, {
            success: function(data, textStatus, jqXHR) {
                for(i = 0; i < data.length; i++) {
                    songInfo = data[i];
                    var si = new SongInfo;
                    si.title = songInfo.title;
                    si.label = songInfo.label;
                    si.ids = songInfo.ids;
                    si.rating = songInfo.rating;
                    collection.add(data[i]);
                }
            } });
          */  
        
        
    });

</script>

<div id="container">
    <div id="main">
        <div id="songlist">
        </div>
    </div>
</div>

<footer>
    Footer Info
</footer>


